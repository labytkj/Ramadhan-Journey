<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Jurnal Ramadhan Premium 1447 H</title>
    
    <!-- Import Font Islami & Modern -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Palet Warna "Nusantara Emerald & Sapphire" */
            --emerald: #0B4D3C;
            --sapphire: #1A4B6E;
            --gold: #D4AF37;
            --terracotta: #B76E5A;
            --cream: #FDF6E9;
            
            /* Light Theme */
            --bg-body: var(--cream);
            --bg-card: #FFFFFF;
            --bg-input: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #475569;
            --text-muted: #64748B;
            --border-light: #E2E8F0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --pattern-color: rgba(11, 77, 60, 0.03);
            
            /* Gradient & Effects */
            --primary-gradient: linear-gradient(135deg, var(--emerald), var(--sapphire));
            --accent-gradient: linear-gradient(135deg, var(--gold), #B8860B);
            --nav-gradient: linear-gradient(145deg, var(--emerald), var(--sapphire));
            
            /* Layout */
            --nav-height: 75px;
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
        }

        [data-theme="dark"] {
            --bg-body: #0F172A;
            --bg-card: #1E293B;
            --bg-input: #2D3A4B;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-muted: #94A3B8;
            --border-light: #334155;
            --pattern-color: rgba(212, 175, 55, 0.05);
            
            /* Adjust colors for dark mode */
            --emerald: #0D6B53;
            --sapphire: #2A6B96;
            --gold: #FFD966;
            --terracotta: #D68B78;
            --cream: #2D3A4B;
        }

        body {
            background-color: var(--bg-body);
            background-image: radial-gradient(circle at 10px 10px, var(--pattern-color) 2px, transparent 2px);
            background-size: 30px 30px;
            color: var(--text-primary);
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            padding-bottom: calc(var(--nav-height) + 20px);
            transition: background-color 0.3s, color 0.3s;
            font-size: 16px;
            line-height: 1.5;
        }

        /* Typography */
        h1, h2, h3, .section-title, .day-num, .arabic-font {
            font-family: 'Amiri', serif;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 16px 24px;
        }

        /* Header Sticky */
        header {
            position: sticky;
            top: 0;
            z-index: 90;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--gold);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        [data-theme="dark"] header {
            background: rgba(15, 23, 42, 0.9);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo {
            height: 40px;
            width: auto;
            filter: drop-shadow(0 2px 4px var(--shadow-color));
        }

        .header-titles {
            display: flex;
            flex-direction: column;
        }

        .header-titles h1 {
            font-size: 1.2rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            line-height: 1.2;
        }

        .header-subtitle {
            font-size: 0.65rem;
            color: var(--gold);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 2px solid var(--gold);
            color: var(--emerald);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.2);
        }

        .theme-toggle:hover {
            transform: rotate(180deg) scale(1.1);
            background: var(--gold);
            color: white;
        }

        .settings-btn {
            background: var(--bg-card);
            border: 2px solid var(--gold);
            color: var(--emerald);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.2);
        }

        .settings-btn:hover {
            transform: rotate(90deg) scale(1.1);
            background: var(--gold);
            color: white;
        }

        /* Settings Box */
        .settings-box {
            position: absolute;
            top: 60px;
            right: 0;
            width: 280px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--gold);
            z-index: 100;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--gold);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '‚ú•';
            position: absolute;
            top: 10px;
            right: 10px;
            color: var(--gold);
            opacity: 0.2;
            font-size: 1.5rem;
            font-family: 'Amiri', serif;
        }

        /* Section Title */
        .section-title {
            font-size: 1.3rem;
            color: var(--emerald);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .section-title::before {
            content: '‚óà';
            color: var(--gold);
            font-size: 1.2rem;
        }

        .section-title::after {
            content: '';
            flex-grow: 1;
            height: 2px;
            background: linear-gradient(90deg, var(--gold), transparent);
        }

        [data-theme="dark"] .section-title {
            color: var(--gold);
        }

        /* Forms */
        .label-premium {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 6px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--bg-input);
            color: var(--text-primary);
            transition: all 0.3s;
            margin-bottom: 16px;
        }

        input:focus,
        textarea:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
            outline: none;
        }

        /* Identity Section */
        .identity-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Navigation Controls */
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-card);
            padding: 10px;
            border-radius: 50px;
            border: 2px solid var(--gold);
            margin-bottom: 20px;
        }

        .nav-arrow {
            background: var(--cream);
            border: 2px solid var(--gold);
            color: var(--emerald);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            flex-shrink: 0;
        }

        .nav-arrow:hover {
            background: var(--gold);
            color: white;
            transform: scale(1.1) rotate(360deg);
        }

        .day-tabs {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: none;
            flex-grow: 1;
        }

        .day-tabs::-webkit-scrollbar {
            display: none;
        }

        .day-tab {
            flex: 0 0 auto;
            min-width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .day-tab.active {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--gold);
            transform: scale(1.15);
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3);
        }

        /* Banner Day */
        .banner-day {
            background: var(--primary-gradient);
            color: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border: 2px solid var(--gold);
            box-shadow: 0 8px 20px rgba(11, 77, 60, 0.3);
        }

        .day-num {
            font-size: 2rem;
            line-height: 1;
            margin-bottom: 4px;
            font-weight: 700;
        }

        .date-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .status-container {
            background: rgba(0, 0, 0, 0.2);
            padding: 4px;
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 90px;
        }

        .btn-status {
            padding: 8px 12px;
            border-radius: 30px;
            border: none;
            font-weight: 700;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-status.active {
            background: white;
            color: var(--emerald);
            transform: scale(1.05);
        }

        .btn-status.inactive {
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Grid Check */
        .grid-check {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .box-check {
            background: var(--bg-input);
            border: 2px solid var(--border-light);
            padding: 14px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .box-check:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.2);
        }

        .box-check:has(input:checked) {
            background: rgba(212, 175, 55, 0.1);
            border-color: var(--gold);
        }

        .box-check input {
            width: 20px;
            height: 20px;
            accent-color: var(--emerald);
            cursor: pointer;
        }

        /* Non Fasting Reason */
        .non-fasting-reason {
            background: rgba(183, 110, 90, 0.1);
            padding: 16px;
            border-radius: var(--radius-md);
            border: 2px solid var(--terracotta);
            margin-bottom: 20px;
        }

        /* Disabled Section */
        .disabled-section {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.5);
        }

        /* Button Premium */
        .btn-premium {
            width: 100%;
            padding: 16px;
            background: var(--accent-gradient);
            color: #1E293B;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 700;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Amiri', serif;
            margin-top: 20px;
        }

        .btn-premium:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }

        .btn-premium:disabled {
            filter: grayscale(1);
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* History Container */
        #historyContainer {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
            scrollbar-width: thin;
            scrollbar-color: var(--gold) transparent;
        }

        #historyContainer::-webkit-scrollbar {
            width: 5px;
        }

        #historyContainer::-webkit-scrollbar-thumb {
            background-color: var(--gold);
            border-radius: 10px;
        }

        .history-item {
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 16px;
            margin-bottom: 16px;
        }

        .history-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--primary-gradient);
            color: white;
            padding: 16px;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 2px solid var(--gold);
        }

        .stat-card.secondary {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .stat-value {
            font-size: 2rem;
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-top: 8px;
        }

        /* Progress Bars */
        .progress-container {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            width: 0%;
            transition: width 1s;
        }

        /* Pie Chart */
        .pie-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pie-inner {
            position: absolute;
            width: 64px;
            height: 64px;
            background: inherit;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ========== BOTTOM NAVIGATION BAR ========== */
        .app-nav {
            position: fixed;
            bottom: 20px;
            left: 16px;
            right: 16px;
            height: var(--nav-height);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(11, 77, 60, 0.2);
            border: 2px solid var(--gold);
            padding: 6px;
            max-width: 400px;
            margin: 0 auto;
        }

        [data-theme="dark"] .app-nav {
            background: rgba(30, 41, 59, 0.95);
            border-color: var(--gold);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.6rem;
            font-weight: 600;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px 4px;
            border-radius: 40px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: -1;
        }

        .nav-item:hover::before {
            width: 150%;
            height: 150%;
        }

        .nav-item.active {
            color: white;
            background: var(--primary-gradient);
            transform: translateY(-8px) scale(1.1);
            box-shadow: 0 8px 15px rgba(11, 77, 60, 0.3);
            border: 2px solid var(--gold);
        }

        .nav-item.active::before {
            display: none;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .nav-icon svg {
            width: 100%;
            height: 100%;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .nav-item span {
            transition: all 0.3s;
        }

        .nav-item.active span {
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* Animasi untuk nav item */
        @keyframes navPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(212, 175, 55, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0);
            }
        }

        .nav-item.active {
            animation: navPulse 2s infinite;
        }

        /* Gallery Styles */
        .gallery-nav-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-card);
            padding: 10px;
            border-radius: 50px;
            border: 2px solid var(--gold);
            margin-bottom: 20px;
        }

        .gallery-day-tabs {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: none;
            flex-grow: 1;
        }

        .gallery-day-tabs::-webkit-scrollbar {
            display: none;
        }

        .gallery-day-tab {
            flex: 0 0 auto;
            min-width: 38px;
            height: 38px;
            border-radius: 50%;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gallery-day-tab.active {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--gold);
            transform: scale(1.1);
        }

        .gallery-day-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            background: rgba(212, 175, 55, 0.1);
            padding: 12px 16px;
            border-radius: 50px;
            border-left: 4px solid var(--gold);
        }

        .gallery-day-badge {
            background: var(--primary-gradient);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            border: 2px solid var(--gold);
        }

        .upload-area {
            border: 3px dashed var(--gold);
            border-radius: var(--radius-lg);
            padding: 30px 20px;
            text-align: center;
            background: var(--bg-input);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 16px;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--emerald);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: inline-block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .image-preview-container {
            position: relative;
            margin-bottom: 16px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 3px solid var(--gold);
        }

        .image-preview {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            background: var(--bg-input);
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--terracotta);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-image:hover {
            transform: scale(1.1) rotate(90deg);
            background: #9B4F3F;
        }

        .caption-input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--bg-input);
            color: var(--text-primary);
            margin-bottom: 16px;
            resize: vertical;
            min-height: 80px;
        }

        .gallery-save-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-gradient);
            color: #1E293B;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .gallery-save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .gallery-item {
            background: var(--bg-card);
            border: 2px solid var(--gold);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 12px 25px rgba(212, 175, 55, 0.3);
        }

        .gallery-item-thumb {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-bottom: 2px solid var(--gold);
            transition: transform 0.5s;
        }

        .gallery-item:hover .gallery-item-thumb {
            transform: scale(1.1);
        }

        .gallery-item-info {
            padding: 12px;
        }

        .gallery-item-day {
            font-size: 0.7rem;
            color: var(--gold);
            font-weight: 700;
            text-transform: uppercase;
        }

        .gallery-item-caption {
            font-size: 0.8rem;
            color: var(--text-primary);
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* FAQ Styles */
        .faq-item {
            border: 2px solid var(--gold);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .faq-question {
            background: var(--bg-card);
            padding: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--emerald);
            transition: background 0.3s;
        }

        .faq-question:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .faq-answer {
            padding: 16px;
            border-top: 2px solid var(--gold);
            background: var(--bg-input);
            color: var(--text-secondary);
            display: none;
            line-height: 1.6;
        }

        .faq-item.open .faq-answer {
            display: block;
            animation: slideDown 0.3s;
        }

        .faq-item.open .faq-question span {
            transform: rotate(180deg);
        }

        /* View Management */
        .view-section {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Lock Message */
        .lock-indicator {
            text-align: center;
            color: var(--gold);
            padding: 10px;
            border: 2px dashed var(--gold);
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            background: rgba(212, 175, 55, 0.1);
            font-weight: 600;
        }

        /* PDF Styles */
        .pdf-styles {
            /* Styles for PDF generation */
        }

        /* Responsive Adjustments */
        @media (max-width: 480px) {
            .header-titles h1 {
                font-size: 1rem;
            }

            .header-subtitle {
                font-size: 0.6rem;
            }

            .header-logo {
                height: 32px;
            }

            .theme-toggle,
            .settings-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .day-tab {
                min-width: 36px;
                height: 36px;
                font-size: 0.9rem;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .nav-item span {
                font-size: 0.55rem;
            }
        }

        /* Login Modal Styles */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .login-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 30px 25px;
            max-width: 400px;
            width: 90%;
            border: 3px solid var(--gold);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.3);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            font-family: 'Amiri', serif;
            font-size: 2rem;
            color: var(--emerald);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--gold);
            font-weight: 600;
        }

        .login-input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--bg-input);
            color: var(--text-primary);
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .login-input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
            outline: none;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 700;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 4px 15px rgba(11, 77, 60, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Amiri', serif;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }

        .logout-btn {
            background: var(--terracotta);
            border: 2px solid var(--gold);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 8px;
        }

        .logout-btn:hover {
            background: #9B4F3F;
            transform: scale(1.05);
        }
    </style>
</head>
<body>

    <!-- LOGIN MODAL -->
    <div id="loginModal" class="login-modal">
        <div class="login-card">
            <div class="login-header">
                <h2>üìñ Jurnal Ramadhan 1447 H</h2>
                <p>SMAN 1 Asembagus</p>
                <p style="font-size: 0.9rem; margin-top: 15px; color: var(--text-muted);">Silakan login untuk melanjutkan</p>
            </div>
            <input type="text" id="loginName" class="login-input" placeholder="Nama Lengkap" autocomplete="off">
            <input type="text" id="loginClass" class="login-input" placeholder="Kelas (Contoh: 10 MIPA 1)" autocomplete="off">
            <button class="login-btn" onclick="handleLogin()">MASUK</button>
        </div>
    </div>

    <!-- NAVIGASI BOTTOM BAR (MENGAMBANG) -->
    <nav class="app-nav no-print">
        <button class="nav-item active" onclick="switchView('jurnal')">
            <span class="nav-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </span>
            <span>Jurnal</span>
        </button>
        <button class="nav-item" onclick="switchView('statistik')">
            <span class="nav-icon">
                <svg viewBox="0 0 24 24">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </span>
            <span>Statistik</span>
        </button>
        <button class="nav-item" onclick="switchView('galeri')">
            <span class="nav-icon">
                <svg viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
            </span>
            <span>Galeri</span>
        </button>
        <button class="nav-item" onclick="switchView('bantuan')">
            <span class="nav-icon">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </span>
            <span>Bantuan</span>
        </button>
    </nav>

    <!-- KONTEN UTAMA -->
    <main class="main-content">
        
        <!-- HEADER -->
        <header>
            <div class="header-left">
                <img src="logo.png" alt="Logo Sekolah" class="header-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2613/2613030.png'">
                <div class="header-titles">
                    <h1>Jurnal Ramadhan 1447H</h1>
                    <span class="header-subtitle">SMAN 1 Asembagus</span>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="theme-toggle" onclick="switchTheme()" id="themeIcon">üåô</button>
                <button class="settings-btn" onclick="toggleSettings(event)">‚öôÔ∏è</button>
                <button class="logout-btn" onclick="logout()" id="logoutBtn" style="display: none;">üö™ Keluar</button>
                <div id="settingsBox" class="settings-box">
                    <label class="label-premium">Mulai 1 Ramadhan</label>
                    <input type="date" id="ramadhanStartInput" style="margin-bottom:12px;">
                    <button class="btn-premium" style="padding:12px; font-size:0.9rem;" onclick="updateRamadhanDate()">Update Tanggal</button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Header PDF -->
            <div id="pdfHeader" style="display:none;">
                <h1 style="font-size: 2.2rem; color: #064e3b; text-align: center;">JURNAL AMALIYAH RAMADHAN 1447 H</h1>
                <p style="letter-spacing: 2px; font-weight: bold; color: #b2945b; text-align: center;">SMAN 1 ASEMBAGUS</p>
                <hr style="border: 1px solid #000; margin: 20px 0;">
            </div>

            <!-- VIEW 1: JURNAL -->
            <div id="view-jurnal" class="view-section active">
                
                <!-- Identitas Santri -->
                <div class="card">
                    <div class="section-title">Identitas Siswa</div>
                    <div class="identity-section no-print">
                        <div>
                            <label class="label-premium">Nama Lengkap</label>
                            <input type="text" id="nameInput" placeholder="Masukkan Nama" disabled>
                        </div>
                        <div>
                            <label class="label-premium">Kelas / Rombel</label>
                            <input type="text" id="classInput" placeholder="Contoh: 10 MIPA 1" disabled>
                        </div>
                    </div>
                    <!-- Versi Tampilan PDF -->
                    <div id="pdfIdentitas" style="display:none; margin-top: 10px;">
                        <p><strong>Nama:</strong> <span id="pName">...</span> &nbsp;|&nbsp; <strong>Kelas:</strong> <span id="pClass">...</span></p>
                    </div>

                </div>

                <!-- Navigasi Hari -->
                <div class="nav-controls no-print">
                    <button class="nav-arrow" onclick="navDay(-1)">‚ùÆ</button>
                    <div class="day-tabs" id="dayTabs"></div>
                    <button class="nav-arrow" onclick="navDay(1)">‚ùØ</button>
                </div>

                <!-- Form Input -->
                <div class="card no-print">
                    <div id="lockedMsg" class="lock-indicator" style="display:none;">üîí ALHAMDULILLAH, DATA TERSIMPAN</div>

                    <div class="banner-day">
                        <div>
                            <h2 class="day-num" id="dayDisplay">Hari ke - 1</h2>
                            <p class="date-label" id="dateDisplay">Memuat Tanggal...</p>
                        </div>
                        <div class="status-container">
                            <button id="puasaYa" class="btn-status active" onclick="setPuasa(true)">PUASA</button>
                            <button id="puasaTidak" class="btn-status inactive" onclick="setPuasa(false)">TIDAK</button>
                        </div>
                    </div>

                    <form id="ramadhanForm">
                        
                        <!-- ALASAN TIDAK PUASA -->
                        <div id="nonFastingReason" class="non-fasting-reason" style="display:none;">
                            <div class="section-title" style="color: var(--terracotta);">Alasan Tidak Puasa</div>
                            <div class="grid-check">
                                <label class="box-check">
                                    <input type="checkbox" name="uzur" value="Haid" onchange="updateHaidState()"><span>Haid/Halangan</span>
                                </label>
                                <label class="box-check"><input type="checkbox" name="uzur" value="Musafir"><span>Musafir</span></label>
                                <label class="box-check"><input type="checkbox" name="uzur" value="Sakit"><span>Sakit</span></label>
                            </div>
                            <input type="text" id="uzurLainnya" placeholder="Alasan Lainnya...">
                        </div>

                        <!-- Container Ibadah -->
                        <div id="ibadahContainer">
                            <div class="section-title">Shalat Fardhu</div>
                            <div class="grid-check">
                                <label class="box-check"><input type="checkbox" name="fardhu" value="Subuh"><span>Subuh</span></label>
                                <label class="box-check"><input type="checkbox" name="fardhu" value="Dzuhur"><span>Dzuhur</span></label>
                                <label class="box-check"><input type="checkbox" name="fardhu" value="Ashar"><span>Ashar</span></label>
                                <label class="box-check"><input type="checkbox" name="fardhu" value="Maghrib"><span>Maghrib</span></label>
                                <label class="box-check"><input type="checkbox" name="fardhu" value="Isya"><span>Isya</span></label>
                            </div>

                            <div class="section-title">Shalat Sunnah</div>
                            <div class="grid-check">
                                <label class="box-check"><input type="checkbox" name="sunnah" value="Tarawih"><span>Tarawih</span></label>
                                <label class="box-check"><input type="checkbox" name="sunnah" value="Witir"><span>Witir</span></label>
                                <label class="box-check"><input type="checkbox" name="sunnah" value="Rawatib"><span>Rawatib</span></label>
                            </div>
                            <input type="text" id="otherSunnah" placeholder="Sunnah Lain (Dhuha, Tahajud, dsb)" style="margin-bottom:20px;">

                            <div class="section-title">Tilawah Al-Qur'an</div>
                            <div style="display:flex; flex-direction: column; gap:12px; margin-bottom:20px;">
                                <div><label class="label-premium">Surat</label><input type="text" id="qSurat" placeholder="Nama Surat"></div>
                                <div><label class="label-premium">Juz / Hal</label><input type="text" id="qJuz" placeholder="Juz 1 / Hal 10"></div>
                            </div>
                        </div>

                        <div class="section-title">Catatan</div>
                        <textarea id="dailyNotes" rows="3" placeholder="Kebaikan hari ini..."></textarea>

                        <button type="submit" id="saveBtn" class="btn-premium">SIMPAN KEBAIKAN</button>
                    </form>
                </div>

                <!-- Riwayat -->
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <span style="font-size: 1.3rem; color: var(--emerald); font-weight: 700;">‚óà Ringkasan Amaliyah</span>
                        <div style="flex-grow: 1; height: 2px; background: linear-gradient(90deg, var(--gold), transparent);"></div>
                        <button onclick="saveAsPDF()" class="no-print" style="background:none; border:2px solid var(--gold); border-radius:30px; padding:6px 15px; color:var(--emerald); cursor:pointer; font-weight:600; font-size:0.8rem;">üìÑ Simpan PDF</button>
                    </div>
                    <div id="historyContainer"></div>
                </div>
            </div>

            <!-- VIEW 2: STATISTIK -->
            <div id="view-statistik" class="view-section">
                <div class="section-title">Statistik Ibadah</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="pie-container" id="chartStatusPuasa">
                            <div class="pie-inner">
                                <span class="stat-value" id="statPuasaMain">0</span>
                            </div>
                        </div>
                        <div class="stat-label">Status Puasa</div>
                        <div style="display:flex; justify-content:space-around; margin-top:12px;">
                            <div><span style="color: var(--gold);">‚úì</span> Puasa: <span id="labelPuasaCount">0</span></div>
                            <div><span style="color: var(--terracotta);">‚úó</span> Tidak: <span id="labelTidakPuasaCount">0</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card secondary">
                        <div class="pie-container" id="chartTarawih">
                            <div class="pie-inner"><span class="stat-value" id="statTarawih">0</span></div>
                        </div>
                        <div class="stat-label">Shalat Tarawih</div>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">Konsistensi Shalat Fardhu</div>
                    
                    <div style="display:flex; flex-direction:column; gap:12px;">
                        <div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>Subuh</span> <span id="valSubuh">0%</span>
                            </div>
                            <div class="progress-container"><div class="progress-bar" id="progSubuh"></div></div>
                        </div>
                        <div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>Dzuhur</span> <span id="valDzuhur">0%</span>
                            </div>
                            <div class="progress-container"><div class="progress-bar" id="progDzuhur"></div></div>
                        </div>
                        <div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>Ashar</span> <span id="valAshar">0%</span>
                            </div>
                            <div class="progress-container"><div class="progress-bar" id="progAshar"></div></div>
                        </div>
                        <div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>Maghrib</span> <span id="valMaghrib">0%</span>
                            </div>
                            <div class="progress-container"><div class="progress-bar" id="progMaghrib"></div></div>
                        </div>
                        <div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>Isya</span> <span id="valIsya">0%</span>
                            </div>
                            <div class="progress-container"><div class="progress-bar" id="progIsya"></div></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">Capaian Tilawah</div>
                    <div id="tilawahList">
                        <p class="text-center" style="color:var(--text-muted);">Belum ada data tilawah.</p>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: GALERI -->
            <div id="view-galeri" class="view-section">
                <div class="section-title">Galeri Ramadhan 30 Hari</div>
                
                <!-- Navigasi Hari Galeri -->
                <div class="gallery-nav-controls no-print">
                    <button class="nav-arrow" onclick="galleryNavDay(-1)">‚ùÆ</button>
                    <div class="gallery-day-tabs" id="galleryDayTabs"></div>
                    <button class="nav-arrow" onclick="galleryNavDay(1)">‚ùØ</button>
                </div>

                <!-- Form Upload per Hari -->
                <div class="card">
                    <div id="galleryUploadForm"></div>
                    
                    <div class="section-title" style="margin-top: 30px;">üì∏ Koleksi Foto</div>
                    <div id="galleryGrid" class="gallery-grid"></div>
                </div>
            </div>

            <!-- VIEW 4: BANTUAN -->
            <div id="view-bantuan" class="view-section">
                <div class="section-title">Pusat Bantuan</div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Cara mengubah tanggal 1 Ramadhan? <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">Klik ikon roda gigi (‚öôÔ∏è) di pojok kanan atas header, lalu pilih tanggal mulai dan klik "Update Tanggal".</div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Apakah data akan hilang jika ditutup? <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">Tidak. Data tersimpan di memori browser (LocalStorage) perangkat Anda.</div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Cara menyimpan jurnal sebagai PDF? <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">Masuk ke menu "Jurnal", scroll ke bawah ke bagian "Ringkasan Amaliyah", lalu klik tombol "Simpan PDF".</div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Cara upload foto? <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">Masuk ke menu "Galeri", pilih hari, klik area upload, pilih foto, tambahkan keterangan, lalu klik "Simpan Foto".</div>
                </div>

                <div class="section-title" style="margin-top: 30px;">Panduan Ibadah</div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Tata Cara Wudhu <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        <ol style="padding-left: 20px; margin: 0;">
                            <li>Membaca Basmalah & Niat wudhu dalam hati.</li>
                            <li>Membasuh kedua telapak tangan (3x).</li>
                            <li>Berkumur-kumur & Istinsyaq (menghirup air ke hidung) (3x).</li>
                            <li>Membasuh wajah secara merata (batas rambut hingga dagu) (3x).</li>
                            <li>Membasuh kedua tangan hingga siku (dahulukan kanan) (3x).</li>
                            <li>Mengusap sebagian kepala/rambut (3x).</li>
                            <li>Membasuh kedua telinga (3x).</li>
                            <li>Membasuh kedua kaki hingga mata kaki (3x).</li>
                            <li>Tertib (berurutan) & Membaca doa setelah wudhu.</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Tata Cara Sholat Fardhu <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        <ol style="padding-left: 20px; margin: 0;">
                            <li>Berdiri tegak menghadap kiblat & Niat.</li>
                            <li>Takbiratul Ihram (Allahu Akbar).</li>
                            <li>Membaca Doa Iftitah (Sunnah) & Surat Al-Fatihah (Wajib).</li>
                            <li>Ruku' dengan tuma'ninah.</li>
                            <li>I'tidal (bangun dari ruku') dengan tuma'ninah.</li>
                            <li>Sujud pertama dengan tuma'ninah.</li>
                            <li>Duduk di antara dua sujud.</li>
                            <li>Sujud kedua.</li>
                            <li>Berdiri untuk rakaat selanjutnya atau Tahiyat Akhir.</li>
                            <li>Salam (menoleh ke kanan lalu ke kiri).</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Tata Cara Puasa Ramadhan <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        <ul style="padding-left: 20px; margin: 0;">
                            <li><strong>Niat:</strong> Dilakukan pada malam hari sebelum fajar (Sahur).<br><em>"Nawaitu shauma ghadin 'an adaa'i fardhi syahri ramadhaana haadzihis sanati lillaahi ta'aala."</em></li>
                            <li><strong>Sahur:</strong> Makan sebelum waktu imsak/subuh (Sunnah & Berkah).</li>
                            <li><strong>Menahan Diri:</strong> Dari makan, minum, dan hal-hal yang membatalkan puasa mulai terbit fajar hingga terbenam matahari (Maghrib).</li>
                            <li><strong>Berbuka:</strong> Segera berbuka saat adzan Maghrib berkumandang, disunnahkan dengan kurma atau air putih.</li>
                        </ul>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                        Tata Cara Sholat Tarawih <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        <ul style="padding-left: 20px; margin: 0;">
                            <li><strong>Waktu:</strong> Dilakukan setelah sholat Isya pada bulan Ramadhan.</li>
                            <li><strong>Niat:</strong> <em>"Ushalli sunnatat taraawiihi rak'ataini (ma'muman/imaaman) lillaahi ta'aalaa."</em></li>
                            <li><strong>Pelaksanaan:</strong> 
                                <br>- Umumnya dilakukan 2 rakaat salam, 2 rakaat salam.
                                <br>- Jumlah rakaat bervariasi (biasanya 8 rakaat + 3 witir, atau 20 rakaat + 3 witir).
                            </li>
                            <li><strong>Ditutup Witir:</strong> Sholat ganjil (biasanya 3 rakaat) sebagai penutup ibadah malam.</li>
                        </ul>
                    </div>
                </div>

                <div class="card" style="margin-top:20px; text-align:center;">
                    <h3>Butuh Bantuan Lebih Lanjut?</h3>
                    <p style="color:var(--text-muted); margin-top:10px;">Hubungi Panitia Ramadhan SMAN 1 Asembagus.</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Constants
        const DB_NAME = 'jurnal_mewah_v1';
        const DB_START = 'jurnal_start_date';
        const DB_ID = 'jurnal_user_id';
        const DB_THEME = 'jurnal_theme_pref';
        const DB_GALLERY = 'jurnal_gallery_v1';
        const DB_LOGIN = 'jurnal_login_status';

        // Data
        let dataJurnal = JSON.parse(localStorage.getItem(DB_NAME)) || [];
        let userIdent = JSON.parse(localStorage.getItem(DB_ID)) || { name: '', class: '' };
        let startDate = localStorage.getItem(DB_START) || "2026-02-17";
        let activeDay = 0;
        let isPuasa = true;
        let galleryActiveDay = 0;
        let galleryData = JSON.parse(localStorage.getItem(DB_GALLERY)) || [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            applySavedTheme();
            
            // Check if user is already logged in
            if (localStorage.getItem(DB_LOGIN) === 'true' && userIdent.name && userIdent.class) {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'flex';
                initIdentity();
                renderTabs();
                refreshUI();
                renderHistory();
                document.getElementById('ramadhanStartInput').value = startDate;
                renderGalleryTabs();
                renderGalleryUploadForm();
                renderGalleryGrid();
            } else {
                document.getElementById('loginModal').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        });

        // Login Function
        function handleLogin() {
            const name = document.getElementById('loginName').value.trim();
            const className = document.getElementById('loginClass').value.trim();

            if (!name || !className) {
                alert('Mohon isi Nama dan Kelas!');
                return;
            }

            userIdent = { name, class: className };
            localStorage.setItem(DB_ID, JSON.stringify(userIdent));
            localStorage.setItem(DB_LOGIN, 'true');

            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'flex';
            
            initIdentity();
            renderTabs();
            refreshUI();
            renderHistory();
            document.getElementById('ramadhanStartInput').value = startDate;
            renderGalleryTabs();
            renderGalleryUploadForm();
            renderGalleryGrid();
        }

        // Logout Function
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar? Data jurnal Anda akan tetap tersimpan.')) {
                localStorage.removeItem(DB_LOGIN);
                document.getElementById('loginModal').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';
                
                // Reset form
                document.getElementById('nameInput').value = '';
                document.getElementById('classInput').value = '';
                document.getElementById('loginName').value = '';
                document.getElementById('loginClass').value = '';
                
                // Hide main content
                document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                document.getElementById('view-jurnal').classList.add('active');
            }
        }

        // Theme Functions
        function applySavedTheme() {
            if(localStorage.getItem(DB_THEME) === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('themeIcon').innerText = '‚òÄÔ∏è';
            }
        }

        function switchTheme() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            
            if(body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                icon.innerText = 'üåô';
                localStorage.setItem(DB_THEME, 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.innerText = '‚òÄÔ∏è';
                localStorage.setItem(DB_THEME, 'dark');
            }
        }

        // Navigation
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById('view-' + viewName).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(nav => {
                if(nav.getAttribute('onclick').includes(viewName)) {
                    nav.classList.add('active');
                }
            });

            if(viewName === 'statistik') calculateStats();
        }

        // Settings
        function toggleSettings(e) {
            e.stopPropagation();
            const box = document.getElementById('settingsBox');
            box.style.display = box.style.display === 'none' ? 'block' : 'none';
        }

        window.onclick = (e) => {
            if(!e.target.closest('.settings-box') && !e.target.closest('.settings-btn')) {
                document.getElementById('settingsBox').style.display = 'none';
            }
        };

        function updateRamadhanDate() {
            startDate = document.getElementById('ramadhanStartInput').value;
            localStorage.setItem(DB_START, startDate);
            document.getElementById('settingsBox').style.display = 'none';
            refreshUI();
            renderGalleryUploadForm();
            alert("Kalender diperbarui!");
        }

        // Identity
        function saveIdentity() {
            // This function is kept but identity inputs are disabled
            // Data already saved via login
            document.getElementById('pName').innerText = userIdent.name || '...';
            document.getElementById('pClass').innerText = userIdent.class || '...';
        }

        function initIdentity() {
            document.getElementById('nameInput').value = userIdent.name;
            document.getElementById('classInput').value = userIdent.class;
            document.getElementById('pName').innerText = userIdent.name || '...';
            document.getElementById('pClass').innerText = userIdent.class || '...';
        }

        // Tabs
        function renderTabs() {
            const container = document.getElementById('dayTabs');
            container.innerHTML = '';
            for(let i=0; i<30; i++) {
                const btn = document.createElement('button');
                btn.className = `day-tab ${i === activeDay ? 'active' : ''}`;
                btn.innerText = i + 1;
                btn.onclick = () => { activeDay = i; refreshUI(); };
                container.appendChild(btn);
            }
        }

        function navDay(dir) {
            let target = activeDay + dir;
            if(target >= 0 && target < 30) {
                activeDay = target;
                refreshUI();
            }
        }

        // Refresh UI
        function refreshUI() {
            document.querySelectorAll('.day-tab').forEach((btn, idx) => {
                btn.className = `day-tab ${idx === activeDay ? 'active' : ''}`;
            });
            
            const dateObj = new Date(startDate);
            dateObj.setDate(dateObj.getDate() + activeDay);
            const displayDate = dateObj.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });

            document.getElementById('dayDisplay').innerText = `Hari ke - ${activeDay + 1}`;
            document.getElementById('dateDisplay').innerText = displayDate;

            const existing = dataJurnal.find(d => d.date === dateObj.toISOString().split('T')[0]);
            const form = document.getElementById('ramadhanForm');
            const elements = form.querySelectorAll('input, textarea, #saveBtn');
            const lockMsg = document.getElementById('lockedMsg');

            if(existing) {
                lockMsg.style.display = 'block';
                isPuasa = existing.fasting === 'Puasa';
                fillForm(existing);
                elements.forEach(el => el.disabled = true);
                document.getElementById('saveBtn').innerText = '‚úì TELAH TERKUNCI';
            } else {
                lockMsg.style.display = 'none';
                form.reset();
                isPuasa = true;
                document.querySelectorAll('input[name="uzur"]').forEach(el => el.checked = false);
                document.getElementById('uzurLainnya').value = '';
                elements.forEach(el => el.disabled = false);
                document.getElementById('saveBtn').innerText = 'SIMPAN KEBAIKAN';
            }
            
            updatePuasaButtons();
            
            const reasonBox = document.getElementById('nonFastingReason');
            reasonBox.style.display = (!isPuasa && !existing) ? 'block' : 'none';
            
            updateHaidState();

            const activeTab = document.querySelectorAll('.day-tab')[activeDay];
            if(activeTab) activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }

        // Haid State
        function updateHaidState() {
            const haidCheckbox = document.querySelector('input[name="uzur"][value="Haid"]');
            const isHaid = haidCheckbox ? haidCheckbox.checked : false;
            const ibadahContainer = document.getElementById('ibadahContainer');
            const saveBtn = document.getElementById('saveBtn');
            
            if (saveBtn.innerText === '‚úì TELAH TERKUNCI') return;

            if (isHaid) {
                ibadahContainer.classList.add('disabled-section');
                document.querySelectorAll('input[name="fardhu"], input[name="sunnah"], #otherSunnah, #qSurat, #qJuz')
                    .forEach(el => { if(el) el.disabled = true; });
            } else {
                ibadahContainer.classList.remove('disabled-section');
                document.querySelectorAll('input[name="fardhu"], input[name="sunnah"], #otherSunnah, #qSurat, #qJuz')
                    .forEach(el => { if(el) el.disabled = false; });
            }
        }

        // Puasa
        function setPuasa(val) {
            const dateObj = new Date(startDate);
            dateObj.setDate(dateObj.getDate() + activeDay);
            const iso = dateObj.toISOString().split('T')[0];
            
            if(!dataJurnal.some(d => d.date === iso)) { 
                isPuasa = val; 
                updatePuasaButtons(); 
                
                const reasonBox = document.getElementById('nonFastingReason');
                reasonBox.style.display = val ? 'none' : 'block';
                
                if(val) {
                    document.querySelectorAll('input[name="uzur"]').forEach(el => el.checked = false);
                    document.getElementById('uzurLainnya').value = '';
                }
                updateHaidState();
            }
        }

        function updatePuasaButtons() {
            const ya = document.getElementById('puasaYa');
            const tdk = document.getElementById('puasaTidak');
            ya.className = `btn-status ${isPuasa ? 'active' : 'inactive'}`;
            tdk.className = `btn-status ${!isPuasa ? 'active' : 'inactive'}`;
        }

        // Fill Form
        function fillForm(data) {
            if(data.fardhu) {
                data.fardhu.forEach(v => {
                    const cb = document.querySelector(`input[name="fardhu"][value="${v}"]`);
                    if(cb) cb.checked = true;
                });
            }
            if(data.sunnah) {
                data.sunnah.forEach(v => {
                    const cb = document.querySelector(`input[name="sunnah"][value="${v}"]`);
                    if(cb) cb.checked = true;
                });
            }
            document.getElementById('otherSunnah').value = data.otherSunnah || '';
            document.getElementById('qSurat').value = data.qSurat || '';
            document.getElementById('qJuz').value = data.qJuz || '';
            document.getElementById('dailyNotes').value = data.notes || '';
            
            if(data.fasting === 'Tidak') {
                document.getElementById('nonFastingReason').style.display = 'block';
                if(data.uzur) {
                    data.uzur.forEach(u => {
                        const cb = document.querySelector(`input[name="uzur"][value="${u}"]`);
                        if(cb) cb.checked = true;
                        if(!['Haid', 'Musafir', 'Sakit'].includes(u)) {
                            document.getElementById('uzurLainnya').value = u;
                        }
                    });
                }
            }
        }

        // Submit Form
        document.getElementById('ramadhanForm').onsubmit = (e) => {
            e.preventDefault();
            const dateObj = new Date(startDate);
            dateObj.setDate(dateObj.getDate() + activeDay);
            
            let uzurList = [];
            if(!isPuasa) {
                uzurList = Array.from(document.querySelectorAll('input[name="uzur"]:checked')).map(c => c.value);
                const lain = document.getElementById('uzurLainnya').value;
                if(lain) uzurList.push(lain);
            }

            const entry = {
                id: Date.now(),
                date: dateObj.toISOString().split('T')[0],
                dayNum: activeDay + 1,
                fasting: isPuasa ? 'Puasa' : 'Tidak',
                uzur: uzurList,
                fardhu: Array.from(document.querySelectorAll('input[name="fardhu"]:checked')).map(c => c.value),
                sunnah: Array.from(document.querySelectorAll('input[name="sunnah"]:checked')).map(c => c.value),
                otherSunnah: document.getElementById('otherSunnah').value,
                qSurat: document.getElementById('qSurat').value,
                qJuz: document.getElementById('qJuz').value,
                notes: document.getElementById('dailyNotes').value
            };
            
            dataJurnal.push(entry);
            dataJurnal.sort((a,b) => b.dayNum - a.dayNum);
            localStorage.setItem(DB_NAME, JSON.stringify(dataJurnal));
            refreshUI();
            renderHistory();
            alert("Subhanallah, data Anda telah tersimpan.");
        };

        // History
        function renderHistory() {
            const container = document.getElementById('historyContainer');
            
            if(dataJurnal.length === 0) {
                container.innerHTML = '<p style="text-align:center; opacity:0.5; padding:20px;">Belum ada riwayat tercatat.</p>';
                return;
            }
            
            container.innerHTML = '';
            dataJurnal.forEach(j => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                let statusHtml = `<span style="background:${j.fasting === 'Puasa' ? 'rgba(11,77,60,0.1)' : 'rgba(183,110,90,0.1)'}; color:${j.fasting === 'Puasa' ? 'var(--emerald)' : 'var(--terracotta)'}; padding:4px 8px; border-radius:20px; font-size:0.8rem;">${j.fasting}</span>`;
                
                if(j.fasting === 'Tidak' && j.uzur && j.uzur.length > 0) {
                    statusHtml += `<div style="font-size:0.7rem; color:var(--terracotta); margin-top:4px;">${j.uzur.join(', ')}</div>`;
                }

                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px;">
                        <strong style="color:var(--emerald);">Hari ke-${j.dayNum}</strong>
                        <div>${statusHtml}</div>
                    </div>
                    <div style="font-size:0.85rem;">
                        üìÖ ${j.date}<br>
                        üïå Fardhu: ${j.fardhu.join(', ') || '-'}<br>
                        ‚ú® Sunnah: ${[...j.sunnah, j.otherSunnah].filter(x => x).join(', ') || '-'}<br>
                        üìñ ${j.qSurat || '-'} (${j.qJuz || '-'})<br>
                        üìù "${j.notes || '-'}"
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Statistics
        function calculateStats() {
            const totalDays = 30;
            const filledDays = dataJurnal.length;
            
            const puasaCount = dataJurnal.filter(d => d.fasting === 'Puasa').length;
            const tidakPuasaCount = dataJurnal.filter(d => d.fasting === 'Tidak').length;

            const puasaPct = (puasaCount / totalDays) * 100;
            const tidakPuasaPct = (tidakPuasaCount / totalDays) * 100;
            const totalFilledPct = puasaPct + tidakPuasaPct;

            document.getElementById('statPuasaMain').innerText = puasaCount;
            document.getElementById('labelPuasaCount').innerText = puasaCount;
            document.getElementById('labelTidakPuasaCount').innerText = tidakPuasaCount;

            const chartEl = document.getElementById('chartStatusPuasa');
            chartEl.style.background = `conic-gradient(
                var(--gold) 0% ${puasaPct}%, 
                var(--terracotta) ${puasaPct}% ${totalFilledPct}%, 
                rgba(255,255,255,0.2) ${totalFilledPct}% 100%
            )`;

            const tarawihCount = dataJurnal.filter(d => d.sunnah && d.sunnah.includes('Tarawih')).length;
            document.getElementById('statTarawih').innerText = tarawihCount;
            const tarawihPct = (tarawihCount / totalDays) * 100;
            document.getElementById('chartTarawih').style.background = `conic-gradient(var(--emerald) 0% ${tarawihPct}%, var(--border-light) ${tarawihPct}% 100%)`;

            let fardhuCounts = { Subuh: 0, Dzuhur: 0, Ashar: 0, Maghrib: 0, Isya: 0 };
            
            dataJurnal.forEach(d => {
                if(d.fardhu) {
                    d.fardhu.forEach(f => {
                        if(fardhuCounts[f] !== undefined) fardhuCounts[f]++;
                    });
                }
            });

            ['Subuh', 'Dzuhur', 'Ashar', 'Maghrib', 'Isya'].forEach(shalat => {
                const count = fardhuCounts[shalat];
                const pct = filledDays > 0 ? Math.round((count / filledDays) * 100) : 0;
                document.getElementById('val' + shalat).innerText = pct + "%";
                document.getElementById('prog' + shalat).style.width = pct + "%";
            });

            const tilawahContainer = document.getElementById('tilawahList');
            const tilawahData = dataJurnal.filter(d => d.qSurat && d.qSurat.trim() !== '');
            
            if(tilawahData.length > 0) {
                tilawahContainer.innerHTML = tilawahData.map(d => `
                    <div style="padding:10px; border-bottom:1px solid var(--border-light); display:flex; justify-content:space-between;">
                        <span style="font-weight:600; color:var(--emerald);">Hari ${d.dayNum}</span>
                        <span>üìñ ${d.qSurat} (${d.qJuz})</span>
                    </div>
                `).join('');
            } else {
                tilawahContainer.innerHTML = '<p class="text-center" style="color:var(--text-muted);">Belum ada data tilawah.</p>';
            }
        }

        // ========== FUNGSI SAVE AS PDF ==========
        function saveAsPDF() {
            // Dapatkan data identitas
            const name = userIdent.name || '_____________';
            const className = userIdent.class || '_____________';
            
            // Siapkan HTML untuk PDF
            let historyHTML = '';
            const sortedData = [...dataJurnal].sort((a, b) => a.dayNum - b.dayNum);
            
            if (sortedData.length === 0) {
                historyHTML = '<p style="text-align:center; padding:20px;">Belum ada data jurnal.</p>';
            } else {
                sortedData.forEach(j => {
                    const fardhuList = j.fardhu?.join(', ') || '-';
                    const sunnahList = [...(j.sunnah || []), j.otherSunnah].filter(x => x).join(', ') || '-';
                    const uzurText = (j.fasting === 'Tidak' && j.uzur?.length > 0) ? `<div style="color:#B76E5A; margin-top:4px;">Alasan: ${j.uzur.join(', ')}</div>` : '';
                    
                    historyHTML += `
                        <div style="margin-bottom: 25px; padding: 15px; border: 2px solid #0B4D3C; border-radius: 10px; page-break-inside: avoid;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h3 style="color: #0B4D3C; margin: 0;">Hari ke-${j.dayNum}</h3>
                                <span style="background: ${j.fasting === 'Puasa' ? '#0B4D3C' : '#B76E5A'}; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">${j.fasting}</span>
                            </div>
                            ${uzurText}
                            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <tr>
                                    <td style="padding: 5px 0; width: 100px;"><strong>Tanggal:</strong></td>
                                    <td>${j.date}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px 0;"><strong>Shalat Fardhu:</strong></td>
                                    <td>${fardhuList}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px 0;"><strong>Shalat Sunnah:</strong></td>
                                    <td>${sunnahList}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px 0;"><strong>Tilawah:</strong></td>
                                    <td>${j.qSurat || '-'} (${j.qJuz || '-'})</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px 0;"><strong>Catatan:</strong></td>
                                    <td><em>${j.notes || '-'}</em></td>
                                </tr>
                            </table>
                        </div>
                    `;
                });
            }

            // Buat konten HTML lengkap untuk PDF
            const pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Jurnal Ramadhan 1447 H - ${name}</title>
                    <style>
                        body {
                            font-family: 'Arial', sans-serif;
                            padding: 30px;
                            color: #333;
                            max-width: 1000px;
                            margin: 0 auto;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 3px solid #D4AF37;
                            padding-bottom: 20px;
                        }
                        .header h1 {
                            color: #0B4D3C;
                            font-size: 28px;
                            margin-bottom: 5px;
                        }
                        .header h2 {
                            color: #D4AF37;
                            font-size: 18px;
                            font-weight: normal;
                            margin-top: 0;
                        }
                        .identity {
                            margin: 20px 0 30px;
                            padding: 15px;
                            background: #f9f9f9;
                            border: 2px solid #0B4D3C;
                            border-radius: 10px;
                            font-size: 16px;
                        }
                        .identity p {
                            margin: 5px 0;
                        }
                        .footer {
                            margin-top: 40px;
                            text-align: right;
                            font-style: italic;
                            color: #666;
                            border-top: 1px solid #D4AF37;
                            padding-top: 20px;
                        }
                        @media print {
                            body { padding: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>JURNAL AMALIYAH RAMADHAN 1447 H</h1>
                        <h2>SMAN 1 ASEMBAGUS</h2>
                    </div>
                    
                    <div class="identity">
                        <p><strong>Nama:</strong> ${name}</p>
                        <p><strong>Kelas:</strong> ${className}</p>
                        <p><strong>Tanggal Cetak:</strong> ${new Date().toLocaleDateString('id-ID', { weekday:'long', day:'numeric', month:'long', year:'numeric' })}</p>
                    </div>
                    
                    <h2 style="color: #0B4D3C; border-bottom: 2px solid #D4AF37; padding-bottom: 5px;">Ringkasan Amaliyah 30 Hari</h2>
                    
                    ${historyHTML}
                    
                    <div class="footer">
                        <p>Dicetak dari Aplikasi Jurnal Ramadhan Premium 1447 H</p>
                        <p>¬© SMAN 1 Asembagus</p>
                    </div>
                </body>
                </html>
            `;

            // Buka window baru untuk PDF
            const pdfWindow = window.open('', '_blank');
            pdfWindow.document.write(pdfContent);
            pdfWindow.document.close();
            
            // Trigger print dialog (yang bisa disimpan sebagai PDF)
            setTimeout(() => {
                pdfWindow.focus();
                pdfWindow.print();
            }, 250);
        }

        // Gallery Functions
        function renderGalleryTabs() {
            const container = document.getElementById('galleryDayTabs');
            container.innerHTML = '';
            for(let i=0; i<30; i++) {
                const btn = document.createElement('button');
                btn.className = `gallery-day-tab ${i === galleryActiveDay ? 'active' : ''}`;
                btn.innerText = i + 1;
                btn.onclick = () => { galleryActiveDay = i; renderGalleryUploadForm(); updateGalleryTabs(); };
                container.appendChild(btn);
            }
        }

        function updateGalleryTabs() {
            document.querySelectorAll('.gallery-day-tab').forEach((btn, idx) => {
                btn.className = `gallery-day-tab ${idx === galleryActiveDay ? 'active' : ''}`;
            });
        }

        function galleryNavDay(dir) {
            let target = galleryActiveDay + dir;
            if(target >= 0 && target < 30) {
                galleryActiveDay = target;
                renderGalleryUploadForm();
                updateGalleryTabs();
                const activeTab = document.querySelectorAll('.gallery-day-tab')[galleryActiveDay];
                if(activeTab) activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }

        function renderGalleryUploadForm() {
            const dateObj = new Date(startDate);
            dateObj.setDate(dateObj.getDate() + galleryActiveDay);
            const displayDate = dateObj.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            
            const existingPhoto = galleryData.find(p => p.dayNum === galleryActiveDay + 1);
            
            let html = `
                <div class="gallery-day-header">
                    <div class="gallery-day-badge">${galleryActiveDay + 1}</div>
                    <div class="gallery-day-title">Hari ke-${galleryActiveDay + 1}</div>
                    <div class="gallery-day-date">${displayDate}</div>
                </div>
            `;
            
            if (existingPhoto && existingPhoto.imageData) {
                html += `
                    <div class="image-preview-container">
                        <img src="${existingPhoto.imageData}" class="image-preview" alt="Preview">
                        <button class="remove-image" onclick="removeGalleryImage(${galleryActiveDay + 1})">√ó</button>
                    </div>
                    <textarea id="galleryCaption" class="caption-input" placeholder="Keterangan foto...">${existingPhoto.caption || ''}</textarea>
                `;
            } else {
                html += `
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">Klik atau drag & drop foto</div>
                        <div class="upload-hint">JPG, PNG (Maks. 5MB)</div>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                    </div>
                    <div id="previewContainer" style="display: none;">
                        <img id="imagePreview" class="image-preview" src="" alt="Preview">
                        <button class="remove-image" onclick="clearImagePreview()">√ó</button>
                    </div>
                    <textarea id="galleryCaption" class="caption-input" placeholder="Keterangan foto..."></textarea>
                `;
            }
            
            html += `
                <button class="gallery-save-btn" onclick="saveGalleryPhoto(${galleryActiveDay + 1})">
                    üíæ Simpan Foto Hari ke-${galleryActiveDay + 1}
                </button>
            `;
            
            document.getElementById('galleryUploadForm').innerHTML = html;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.querySelector('.upload-area')?.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.querySelector('.upload-area')?.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.querySelector('.upload-area')?.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) handleImageFile(file);
        }

        function handleImageFile(file) {
            if (!file.type.match('image.*')) {
                alert('Mohon pilih file gambar (JPG, PNG)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const previewContainer = document.getElementById('previewContainer');
                const imagePreview = document.getElementById('imagePreview');
                const uploadArea = document.querySelector('.upload-area');
                
                if (imagePreview) imagePreview.src = e.target.result;
                if (previewContainer) previewContainer.style.display = 'block';
                if (uploadArea) uploadArea.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function clearImagePreview() {
            const previewContainer = document.getElementById('previewContainer');
            const uploadArea = document.querySelector('.upload-area');
            const fileInput = document.getElementById('fileInput');
            
            if (previewContainer) previewContainer.style.display = 'none';
            if (uploadArea) uploadArea.style.display = 'block';
            if (fileInput) fileInput.value = '';
        }

        function removeGalleryImage(dayNum) {
            if (confirm('Hapus foto ini?')) {
                galleryData = galleryData.filter(p => p.dayNum !== dayNum);
                localStorage.setItem(DB_GALLERY, JSON.stringify(galleryData));
                renderGalleryUploadForm();
                renderGalleryGrid();
            }
        }

        function saveGalleryPhoto(dayNum) {
            const previewContainer = document.getElementById('previewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const caption = document.getElementById('galleryCaption')?.value || '';
            
            let imageData = null;
            
            if (previewContainer && previewContainer.style.display !== 'none' && imagePreview && imagePreview.src) {
                imageData = imagePreview.src;
            } else {
                const existingPhoto = galleryData.find(p => p.dayNum === dayNum);
                if (existingPhoto) imageData = existingPhoto.imageData;
            }
            
            if (!imageData) {
                alert('Mohon pilih foto terlebih dahulu');
                return;
            }
            
            const dateObj = new Date(startDate);
            dateObj.setDate(dateObj.getDate() + (dayNum - 1));
            
            galleryData = galleryData.filter(p => p.dayNum !== dayNum);
            
            galleryData.push({
                id: Date.now(),
                dayNum: dayNum,
                date: dateObj.toISOString().split('T')[0],
                imageData: imageData,
                caption: caption,
                createdAt: new Date().toISOString()
            });
            
            galleryData.sort((a, b) => a.dayNum - b.dayNum);
            localStorage.setItem(DB_GALLERY, JSON.stringify(galleryData));
            
            renderGalleryUploadForm();
            renderGalleryGrid();
            alert(`Foto untuk hari ke-${dayNum} berhasil disimpan!`);
        }

        function renderGalleryGrid() {
            const grid = document.getElementById('galleryGrid');
            
            if (galleryData.length === 0) {
                grid.innerHTML = '<p class="text-center" style="color:var(--text-muted); grid-column:1/-1; padding:30px;">Belum ada foto. Mulai upload!</p>';
                return;
            }
            
            grid.innerHTML = galleryData.map(photo => `
                <div class="gallery-item" onclick="viewGalleryImage('${photo.imageData}', '${photo.caption}', ${photo.dayNum})">
                    <img src="${photo.imageData}" class="gallery-item-thumb" alt="Foto Hari ${photo.dayNum}">
                    <div class="gallery-item-info">
                        <div class="gallery-item-day">Hari ke-${photo.dayNum}</div>
                        <div class="gallery-item-caption">${photo.caption || 'Tidak ada keterangan'}</div>
                    </div>
                </div>
            `).join('');
        }

        function viewGalleryImage(imageData, caption, dayNum) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.9);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%; position: relative;">
                    <img src="${imageData}" style="max-width: 100%; max-height: 90vh; border-radius: 8px; border: 3px solid var(--gold);">
                    <div style="position: absolute; bottom: -40px; left: 0; right: 0; text-align: center; color: white; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 20px;">
                        Hari ke-${dayNum} ‚Ä¢ ${caption || 'Tidak ada keterangan'}
                    </div>
                    <button style="position: absolute; top: -40px; right: 0; background: var(--terracotta); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.5rem;" onclick="this.closest('div[style*="fixed"]').remove()">√ó</button>
                </div>
            `;
            
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>